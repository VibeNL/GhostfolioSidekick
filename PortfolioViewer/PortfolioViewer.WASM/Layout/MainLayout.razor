@using GhostfolioSidekick.PortfolioViewer.WASM.Components.Chat
@using GhostfolioSidekick.PortfolioViewer.WASM.Models
@implements IDisposable
@inherits LayoutComponentBase

<div class="page">
    <header>
        <NavMenu @bind-StartDate="@GlobalStartDate"
                 @bind-EndDate="@GlobalEndDate"
                 @bind-SelectedCurrency="@GlobalSelectedCurrency" 
                 @bind-SelectedAccountId="@GlobalSelectedAccountId"
                 ShowFilters="@ShouldShowFilters"
                 ShowDateFilters="@ShouldShowDateFilters"
                 ShowCurrencyFilter="@ShouldShowCurrencyFilter"
                 ShowAccountFilter="@ShouldShowAccountFilters"
                 OnFiltersChanged="@OnGlobalFiltersChanged" />
    </header>

    <main class="content">
        <div class="top-row px-4 auth">
            <LoginDisplay />
            <a href="https://learn.microsoft.com/aspnet/core/" target="_blank">About</a>
        </div>

        <article class="content-body px-4">
            <!-- Debug info for filter state -->
            <div style="background: #e3f2fd; padding: 0.5rem; margin-bottom: 1rem; font-size: 0.8rem; border-radius: 0.25rem;">
                <strong>Filter Debug:</strong> 
                Currency: @GlobalSelectedCurrency (@_filterState.SelectedCurrency) | 
                Start: @GlobalStartDate.ToString("yyyy-MM-dd") (@_filterState.StartDate.ToString("yyyy-MM-dd")) | 
                End: @GlobalEndDate.ToString("yyyy-MM-dd") (@_filterState.EndDate.ToString("yyyy-MM-dd")) | 
                Account: @GlobalSelectedAccountId (@_filterState.SelectedAccountId) |
                Page: @(IsTimeSeriesPage ? "TimeSeries" : IsHoldingsPage ? "Holdings" : "Other")
            </div>
            
            <CascadingValue Value="@_filterState" IsFixed="false">
                @Body
            </CascadingValue>
        </article>
    </main>

    <ChatOverlay />
</div>
